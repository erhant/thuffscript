<p align="center">
  <h1 align="center">
    <code>thuffs</code>
  </h1>

<div align="center">
<img src="https://img.shields.io/badge/%E2%99%A5-black?logo=bun" alt="bun love"/>
<img src="https://img.shields.io/badge/%E2%99%A5-black?logo=typescript&logoColor=white" alt="bun love"/>
<img src="https://img.shields.io/badge/%E2%99%A5-black?logo=data:image/jpeg;base64,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53r753r753r753r753r753r753rHzYpJLu8/9r//2Q==" alt="bun love"/>
</div>

  <p align="center">
    <i>Write, test, and deploy Huff; without ever leaving TypeScript.</i>
  </p>
</p>

## Install

To install dependencies:

```bash
bun install
```

To build:

```sh
bun run build
```

## Usage

Thuffs exposes classes for all Huff constructs:

- `Function` and `Event` classes for function and event interfaces.
- `Label` for jump operations
- `Macro` for `macro` (or `fn`)
- `Main` and `Constructor` macros
- `Table` (todo)

> [!NOTE]
>
> **Thuffs is not a tool to test or deploy Huff contracts**! You should simply use this to write & compile to Huff; the tests can be done via Foundry or Hardhat as is the case usually.

## Example

Here is a Huff code (from Huff [docs](https://docs.huff.sh/tutorial/the-basics/#interacting-with-this-contract-externally)):

```rs
#define function addTwo(uint256,uint256) view returns(uint256)

#define macro ADD_TWO() = takes(0) returns(0) {
    0x04 calldataload     // load first 32 bytes onto the stack - number 1
    0x24 calldataload     // load second 32 bytes onto the stack - number 2
    add                   // add number 1 and 2 and put the result onto the stack

    0x00 mstore           // place the result in memory
    0x20 0x00 return      // return the result
}

#define macro MAIN() = takes(0) returns(0) {
    // get the function selector
    0x00 calldataload 0xE0 shr

    // jump to the implementation of the ADD_TWO function if the calldata matches the function selector
    __FUNC_SIG(addTwo) eq addTwo jumpi

    addTwo:
        ADD_TWO()
}
```

Here is that same code in Thuffs:

```ts
import {Function, Label, Macro, Main} from './definitions';

const addTwoFunc = new Function({name: 'addTwo', args: ['uint256', 'uint256'], type: 'view', returns: ['uint256']});
const addTwoLabel = new Label('addTwo');

const ADD_TWO = new Macro(
  {name: 'ADD_TWO'},

  [0x04, 'CALLDATALOAD'], // load first 32 bytes onto the stack - number 1
  [0x24, 'CALLDATALOAD'], // load second 32 bytes onto the stack - number 2
  'ADD', //                  add number 1 and 2 and put the result onto the stack
  //
  [0b00, 'MSTORE'], //       place the result in memory
  [32, 0, 'RETURN'] //       return the result
);

const MAIN = new Main(
  // get function selector
  [0x00, 'CALLDATALOAD', 0xe0, 'SHR'],
  // jump to iplementation
  [addTwoFunc, 'EQ', addTwoLabel.src, 'JUMPI'],
  // handle jump
  [addTwoLabel.dest, ADD_TWO]
);
```

## See also

- <https://github.com/dethcrypto/evm-ts/blob/master/lib/opcodes/pop.ts>
- <https://twitter.com/Zac_Aztec/status/1697359614692430100>
